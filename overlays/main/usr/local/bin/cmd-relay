#!/usr/bin/env python

import argparse
import serial


def relay_power(args, enable):
    relay = serial.Serial(args.device, 9600)

    if enable:
        relay.write(b'\xa0\x01\x01\xa2')
    else:
        relay.write(b'\xa0\x01\x00\xa1')


def relay_enable(args):
    relay_power(args, True)


def relay_disable(args):
    relay_power(args, False)


def main():
    parser = argparse.ArgumentParser(prog="USB Relay Command", formatter_class=argparse.ArgumentDefaultsHelpFormatter)
    parser.add_argument('-d', '--device', default="/dev/ttyUSB0", help="USB Serial Device")
    subparsers = parser.add_subparsers(required=True)

    parser_en = subparsers.add_parser('enable', help='Enable the USB Relay')
    parser_en.set_defaults(func=relay_enable)

    parser_dis = subparsers.add_parser('disable', help='Disable the USB Relay')
    parser_dis.set_defaults(func=relay_disable)

    args = parser.parse_args()
    args.func(args)


if __name__ == '__main__':
    main()
